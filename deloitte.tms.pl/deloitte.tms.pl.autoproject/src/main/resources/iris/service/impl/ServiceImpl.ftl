<#assign pojo=oneToManyPojo.getOne()>
<#assign many=oneToManyPojo.getMany()>
<#assign ones=oneToManyPojo.getOnes()>
<#assign pojoview=pojo.getDeclarationNameFirstLetterLower()+"View">
<#assign declarationName = pojo.importType(pojo.getDeclarationName())>
<#assign declarationName_firstLower = pojo.getDeclarationNameFirstLetterLower()>
<#assign pojoclassname = "${pojo.getPackageName()}.model.${declarationName}">
<#assign realPackageAndClassPath = "${pojo.getRealPackageAndClassPath()}">
package ${pojo.getPackageName()}.service.impl;
// Generated by bo.wang with ${version}

import java.util.ArrayList;
import java.util.Collection;
import java.util.List;
import java.util.Map;
import java.util.HashMap;

import javax.annotation.Resource;

import org.springframework.stereotype.Component;

import com.ling2.core.commons.support.DaoPage;
import com.ling2.core.commons.utils.AssertHelper;
import com.ling2.core.commons.utils.BatchUtils;
import com.ling2.core.commons.utils.reflect.ReflectUtils;
import com.ling2.core.dao.IDao;
import com.ling2.core.service.impl.BaseService;
import ${pojo.getPackageName()}.model.${declarationName};
import ${pojo.getPackageName()}.model.${declarationName}Param;
<#foreach child in many>
<#assign childdeclarationName = child.importType(child.getDeclarationName())>	
import ${child.getPackageName()}.model.${childdeclarationName};
import ${child.getPackageName()}.model.${childdeclarationName}Param;
</#foreach>
<#foreach child in ones>
<#assign childdeclarationName = child.importType(child.getDeclarationName())>	
import ${child.getPackageName()}.model.${childdeclarationName};
import ${child.getPackageName()}.model.${childdeclarationName}Param;
</#foreach>
import ${pojo.getPackageName()}.dao.${declarationName}Dao;
import ${pojo.getPackageName()}.service.${declarationName}Service;

/**
 * Home object for domain model class ${declarationName}.
 * @see ${pojo.getQualifiedDeclarationName()}
 * @author Hibernate Tools
 */
@Component(${declarationName}Service.BEAN_ID)
public class ${declarationName}ServiceImpl extends BaseService implements ${declarationName}Service{
	@Resource
	${declarationName}Dao ${pojo.getDeclarationNameFirstLetterLower()}Dao;

	@Override
	public IDao getDao() {
		return ${pojo.getDeclarationNameFirstLetterLower()}Dao;
	}

	@Override
	public DaoPage find${declarationName}ByParams(Map params, Integer pageIndex,
			Integer pageSize) {
		if(params==null)
		{
			params=new HashMap();
		}			
		DaoPage daoPage= ${pojo.getDeclarationNameFirstLetterLower()}Dao.find${declarationName}ByParams(params, pageIndex, pageSize);
		daoPage.setResult(convert${declarationName}ToParam((List<${declarationName}>) daoPage.getResult()));
		return daoPage;
	}
	@Override
	public List<${declarationName}Param> find${declarationName}ByParams(Map params) {
		if(params==null)
		{
			params=new HashMap();
		}
		List<${declarationName}> temp= ${pojo.getDeclarationNameFirstLetterLower()}Dao.find${declarationName}ByParams(params);
		return convert${declarationName}ToParam(temp);
	}
	@Override
	public void save${declarationName}DataListsMap(Map dataListsMap) {
		Collection<${declarationName}Param> deleteList = BatchUtils.to(${declarationName}Param.class).getDeleteEntities(dataListsMap);
		Collection<${declarationName}Param> insertList =  BatchUtils.to(${declarationName}Param.class).getInsertEntities(dataListsMap);
		Collection<${declarationName}Param> updateList =  BatchUtils.to(${declarationName}Param.class).getModifiedEntities(dataListsMap);
		if (updateList != null&&updateList.size() > 0) {
			for(${declarationName}Param param: updateList){
				${declarationName} entity=convert${declarationName}ParamToEntity(param);
				${pojo.getDeclarationNameFirstLetterLower()}Dao.update(entity);
			}		
//			${pojo.getDeclarationNameFirstLetterLower()}Dao.updateAll(updateList);
		}
		if (insertList != null&&insertList.size() > 0) {
			for(${declarationName}Param param: insertList){
				${declarationName} entity=convert${declarationName}ParamToEntity(param);
				${pojo.getDeclarationNameFirstLetterLower()}Dao.save(entity);
				param.setId(entity.getId());
			}
//			${pojo.getDeclarationNameFirstLetterLower()}Dao.saveAll(insertList);
		}
		if (deleteList != null&&deleteList.size() > 0) {
			for(${declarationName}Param param:deleteList){
				${declarationName} entity=new ${declarationName}();
				entity.setId(param.getId());
				${pojo.getDeclarationNameFirstLetterLower()}Dao.remove(entity);
			}
//			${pojo.getDeclarationNameFirstLetterLower()}Dao.removeAll(deleteList);
		}
		
	}
	private List<${declarationName}Param> convert${declarationName}ToParam(List<${declarationName}> models){
		List<${declarationName}Param> result=new ArrayList<${declarationName}Param>();
		for(${declarationName} initiation:models){
			${declarationName}Param inparam=convert${declarationName}ToParam(initiation);
			result.add(inparam);
		}
		return result;
	}
	public ${declarationName}Param convert${declarationName}ToParam(${declarationName} model){
		${declarationName}Param inparam=new ${declarationName}Param();
		ReflectUtils.copyProperties(model, inparam);
		return inparam;
	}
	public ${declarationName} convert${declarationName}ParamToEntity(${declarationName}Param param){
		${declarationName} entity=new ${declarationName}();
		ReflectUtils.copyProperties(param, entity);
		return entity;
	}
<#foreach child in many>
<#assign childdeclarationName = child.importType(child.getDeclarationName())>	
<#assign tempchild=child>
	@Override
	public DaoPage find${childdeclarationName}ByParams(Map params, Integer pageIndex,
			Integer pageSize) {
		if(params==null)
		{
			params=new HashMap();
		}			
		DaoPage daoPage= ${pojo.getDeclarationNameFirstLetterLower()}Dao.find${childdeclarationName}ByParams(params, pageIndex, pageSize);
		daoPage.setResult(convert${childdeclarationName}ToParam((List<${childdeclarationName}>) daoPage.getResult()));
		return daoPage;
	}
	@Override
	public List<${childdeclarationName}Param> find${childdeclarationName}ByParams(Map params) {
		if(params==null)
		{
			params=new HashMap();
		}
		List<${childdeclarationName}> temp= ${pojo.getDeclarationNameFirstLetterLower()}Dao.find${childdeclarationName}ByParams(params);
		return convert${childdeclarationName}ToParam(temp);
	}
	@Override
	public void save${childdeclarationName}DataListsMap(Map dataListsMap) {
		Collection<${childdeclarationName}Param> deleteList = BatchUtils.to(${childdeclarationName}Param.class).getDeleteEntities(dataListsMap);
		Collection<${childdeclarationName}Param> insertList =  BatchUtils.to(${childdeclarationName}Param.class).getInsertEntities(dataListsMap);
		Collection<${childdeclarationName}Param> updateList =  BatchUtils.to(${childdeclarationName}Param.class).getModifiedEntities(dataListsMap);
		if (updateList != null&&updateList.size() > 0) {
			for(${childdeclarationName}Param param: updateList){
				${childdeclarationName} entity=convert${childdeclarationName}ParamToEntity(param);
				${pojo.getDeclarationNameFirstLetterLower()}Dao.update(entity);
			}		
//			${pojo.getDeclarationNameFirstLetterLower()}Dao.updateAll(updateList);
		}
		if (insertList != null&&insertList.size() > 0) {
			for(${childdeclarationName}Param param: insertList){
				${childdeclarationName} entity=convert${childdeclarationName}ParamToEntity(param);
				${pojo.getDeclarationNameFirstLetterLower()}Dao.save(entity);
				param.setId(entity.getId());
			}
//			${pojo.getDeclarationNameFirstLetterLower()}Dao.saveAll(insertList);
		}
		if (deleteList != null&&deleteList.size() > 0) {
			for(${childdeclarationName}Param param:deleteList){
				${childdeclarationName} entity=new ${childdeclarationName}();
				entity.setId(param.getId());
				${pojo.getDeclarationNameFirstLetterLower()}Dao.remove(entity);
			}
//			${pojo.getDeclarationNameFirstLetterLower()}Dao.removeAll(deleteList);
		}
	}
	private List<${childdeclarationName}Param> convert${childdeclarationName}ToParam(List<${childdeclarationName}> models){
		List<${childdeclarationName}Param> result=new ArrayList<${childdeclarationName}Param>();
		for(${childdeclarationName} initiation:models){
			${childdeclarationName}Param inparam=convert${childdeclarationName}ToParam(initiation);
			result.add(inparam);
		}
		return result;
	}
	public ${childdeclarationName}Param convert${childdeclarationName}ToParam(${childdeclarationName} model){
		${childdeclarationName}Param inparam=new ${childdeclarationName}Param();
		ReflectUtils.copyProperties(model, inparam);
		return inparam;
	}
	public ${childdeclarationName} convert${childdeclarationName}ParamToEntity(${childdeclarationName}Param param){
		${childdeclarationName} entity=new ${childdeclarationName}();
		ReflectUtils.copyProperties(param, entity);
		return entity;
	}
</#foreach>
<#foreach child in ones>
<#assign childdeclarationName = child.importType(child.getDeclarationName())>	
	public ${childdeclarationName} find${childdeclarationName}(Map params)
	{
		Object value=params.get("${pojo.getDeclarationNameFirstLetterLower()}Id");
		AssertHelper.notEmpty_assert("${childdeclarationName}关联主键不能为空");
		${declarationName} ${pojo.getDeclarationNameFirstLetterLower()}=(${declarationName}) ${pojo.getDeclarationNameFirstLetterLower()}Dao.get(${declarationName}.class, Long.parseLong(value.toString()));
		//return ${pojo.getDeclarationNameFirstLetterLower()}Dao.find${childdeclarationName}(params);
		${childdeclarationName} result= ${pojo.getDeclarationNameFirstLetterLower()}.get${childdeclarationName}();
		if(result==null)
		{
			result=new ${childdeclarationName}();
		}
		return result;
	}
</#foreach>
}
